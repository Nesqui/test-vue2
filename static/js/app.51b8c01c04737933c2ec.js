webpackJsonp([1],{"3YGu":function(t,e){},NHnr:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=o("7+uW"),n=o("Dd8w"),a=o.n(n),i=o("Xxa5"),s=o.n(i),u=o("exGp"),c=o.n(u),m=o("Gu7T"),f=o.n(m),d=o("mvHQ"),l=o.n(d),p=o("//Fk"),v=o.n(p),g={create:function(t){return new v.a(function(e,o){setTimeout(function(){t.amount%2==0?e({success:!0}):o(new Error(l()({success:!1})))},1e3)})}},h={getForm:function(){return JSON.parse(window.localStorage.getItem("form"))},setForm:function(t){window.localStorage.setItem("form",l()(t));var e=new StorageEvent("storage");window.dispatchEvent(e)}},y=o("NYxO");r.a.use(y.a);var _=new y.a.Store({state:{form:{nonce:0,price:"",qty:"",amount:""}},mutations:{setForm:function(t,e){t.form=e}},getters:{getForm:function(t){return t.form}}}),F={local:h,vuex:{store:_,getForm:function(){return _.getters.getForm},setForm:function(t){_.commit("setForm",a()({},t));var e=new StorageEvent("storage");window.dispatchEvent(e)}}},w={qty:0,amount:0,price:0},q={name:"PurchaseForm",props:["storeMode"],data:function(){var t=this;return{loading:!1,form:{nonce:0,price:"",qty:"",amount:""},logs:[],calculator:{qty:function(){if(0!=+t.form.price){var e=(t.form.amount/t.form.price).toFixed(2);t.form.qty=e,t.$refs.qty.value=e}else alert("Прайс не может быть 0")},price:function(){if(0!=+t.form.qty){var e=(t.form.amount/t.form.qty).toFixed(2);t.form.price=e,t.$refs.price.value=e}else alert("Кол-во не может быть 0")},amount:function(){var e=(t.form.qty*t.form.price).toFixed(2);t.form.amount=(t.form.qty*t.form.price).toFixed(2),t.$refs.amount.value=e}},storageForm:{nonce:0,price:"",qty:"",amount:""},formTypes:["qty","amount","price"]}},computed:{isFormValid:function(){return this.form.price&&this.form.qty&&this.form.amount},reversedLogs:function(){return[].concat(f()(this.logs)).reverse()}},created:function(){this.loadStorage(),window.addEventListener("storage",this.loadStorage)},beforeDestroy:function(){window.removeEventListener("storage",this.loadStorage)},methods:{doAfterDelay:function(t,e){clearTimeout(w[t]),w[t]=setTimeout(e,300)},loadStorage:function(){this.storageForm=F[this.storeMode].getForm()},onSubmit:function(){var t=this;return c()(s.a.mark(function e(){var o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.loading=!0,t.form.nonce++,t.addLog("localStore get before request",F[t.storeMode].getForm()),t.addLog("submit clicked",t.form),e.next=7,g.create(t.form);case 7:o=e.sent,F[t.storeMode].setForm(t.form),t.addLog("localStore get after request",F[t.storeMode].getForm()),t.addLog("response received",o),alert("Успешно сохранено"),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(0),t.addLog("error received",JSON.parse(e.t0.message)),alert("Ошибка сервера");case 18:return e.prev=18,t.loading=!1,e.finish(18);case 21:case"end":return e.stop()}},e,t,[[0,14,18,21]])}))()},addLog:function(t,e){this.logs.push({type:t,data:"string"==typeof e?e:a()({},e)})},updateFirstField:function(t){var e=this;if(this.isFormValid){var o=this.logs.find(function(o){return e.formTypes.includes(o.type)&&o.type!==t});this.calculator[o.type]()}},onAmountInput:function(t){var e=this;this.doAfterDelay("amount",function(){e.form.amount=t.target.value,e.onAmountChange()})},onPriceInput:function(t){var e=this;this.doAfterDelay("price",function(){e.form.price=t.target.value,e.onPriceChange()})},onQtyInput:function(t){var e=this;this.doAfterDelay("qty",function(){e.form.qty=t.target.value,e.onQtyChange()})},onPriceChange:function(){this.addLog("price",this.form.price),this.updateFirstField("price")},onQtyChange:function(){this.addLog("qty",this.form.qty),this.updateFirstField("qty")},onAmountChange:function(){this.addLog("amount",this.form.amount),this.updateFirstField("amount")}}},b={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"purchase-form"},[o("form",{attrs:{action:"#"}},[o("div",{staticClass:"form-row"},[o("div",{staticClass:"form-row__item"},[o("input",{ref:"price",attrs:{type:"number",id:"price",placeholder:"Цена"},on:{input:t.onPriceInput}}),t._v(" "),o("label",{attrs:{for:"price"}},[t._v("Цена: "+t._s(t.form.price))])]),t._v(" "),o("div",{staticClass:"form-row__item"},[o("input",{ref:"qty",attrs:{type:"number",id:"qty",placeholder:"Кол-во"},on:{input:t.onQtyInput}}),t._v(" "),o("label",{attrs:{for:"qty"}},[t._v("Количество: "+t._s(t.form.qty))])]),t._v(" "),o("div",{staticClass:"form-row__item"},[o("input",{ref:"amount",attrs:{type:"number",id:"amount",placeholder:"Сумма"},on:{input:t.onAmountInput}}),t._v(" "),o("label",{attrs:{for:"amount"}},[t._v("Сумма: "+t._s(t.form.amount))])]),t._v(" "),o("div",{staticClass:"form-row__item"},[o("button",{ref:"submitBtn",attrs:{id:"submitBtn",disabled:t.loading||!t.isFormValid},on:{click:t.onSubmit}},[t._v("Отправить")]),t._v(" "),o("pre",{staticClass:"logs"},[t._v(t._s(t.storageForm))])])])]),t._v(" "),o("div",[o("pre",{staticClass:"logs"},[t._v(t._s(t.reversedLogs))])])])},staticRenderFns:[]};var x={name:"App",components:{PurchaseForm:o("VU/8")(q,b,!1,function(t){o("pHb0")},"data-v-21db928e",null).exports},data:function(){return{storeMode:""}}},S={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"app"}},[t.storeMode?t._e():o("div",{staticClass:"store-mode"},[o("label",{attrs:{for:"select"}},[t._v("С каким стором работать?")]),t._v(" "),o("select",{directives:[{name:"model",rawName:"v-model",value:t.storeMode,expression:"storeMode"}],attrs:{id:"select",name:"select"},on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.storeMode=e.target.multiple?o:o[0]}}},[o("option",{attrs:{value:"local"}},[t._v("localStorage")]),t._v(" "),o("option",{attrs:{value:"vuex",selected:""}},[t._v("Vuex")])])]),t._v(" "),t.storeMode?o("PurchaseForm",{attrs:{storeMode:t.storeMode}}):t._e()],1)},staticRenderFns:[]};var C=o("VU/8")(x,S,!1,function(t){o("3YGu")},null,null).exports;r.a.config.productionTip=!1,new r.a({el:"#app",components:{App:C},template:"<App/>",store:F.vuex.store})},pHb0:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.51b8c01c04737933c2ec.js.map